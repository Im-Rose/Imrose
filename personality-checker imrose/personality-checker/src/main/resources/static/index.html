<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Personality Checker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body { background-color: #f7f7f7; padding: 30px; }
        .question-card { margin-bottom: 25px; }
        .result { margin-top: 30px; }
        .personality-img { max-width: 300px; margin-top: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h1 class="text-center mb-4">ðŸ§  Personality Quiz</h1>

    <form id="quizForm"></form>

    <div class="text-center">
        <button onclick="submitAnswers()" class="btn btn-primary mt-3">Submit Answers</button>
    </div>

    <div class="result text-center" id="result"></div>
</div>

<script>
    let questions = [];

    async function loadQuestions() {
        const res = await fetch('/api/questions');
        questions = await res.json();

        const form = document.getElementById('quizForm');
        form.innerHTML = '';

        questions.forEach((q, i) => {
            const card = document.createElement('div');
            card.className = 'card question-card p-3';

            card.innerHTML = `
                <h5>${q.id}. ${q.question}</h5>
                ${q.options.map((opt, idx) => `
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="q${i}" value="${idx}" id="q${i}opt${idx}">
                        <label class="form-check-label" for="q${i}opt${idx}">${opt}</label>
                    </div>
                `).join('')}
            `;

            form.appendChild(card);
        });
    }

    async function submitAnswers() {
        const answers = questions.map((_, i) => {
            const radios = document.getElementsByName(`q${i}`);
            for (const r of radios) {
                if (r.checked) return parseInt(r.value);
            }
            return null;
        });

        if (answers.includes(null)) {
            alert("Please answer all questions!");
            return;
        }

        const res = await fetch('/api/submit', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({answers})
        });

        if (!res.ok) {
            alert('Error submitting answers. Please try again.');
            return;
        }

        const data = await res.json();
        showResult(data);
    }

    function showResult(data) {
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = `
            <h2>ðŸŽ‰ Your Personality: <span class="text-success">${data.type}</span></h2>
            <p>${data.description}</p>
            <img src="${data.imageUrl}" class="personality-img" alt="${data.type}">
        `;
    }

    window.onload = loadQuestions;
</script>

</body>
</html>
